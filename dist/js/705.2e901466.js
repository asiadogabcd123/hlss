"use strict";(self["webpackChunkhlss"]=self["webpackChunkhlss"]||[]).push([[705],{2705:function(e,t,o){o.r(t),o.d(t,{default:function(){return Ne}});var n=o(6768),s=o(4232),a=o(5130);const l={class:"access-container"},i={class:"access-card"},r={key:0,class:"loading-section"},u={class:"form-group"},c=["disabled"],d={class:"form-group"},m=["disabled"],p={class:"form-group"},g=["disabled"],f={class:"form-group"},v=["disabled"],b={class:"form-group"},h=["disabled"],y={class:"form-group"},k=["disabled"],L=["disabled"],C={key:2,class:"success-section"},R={key:0,class:"print-success"},w={key:1,class:"print-failed"},S={class:"countdown"};function E(e,t,o,E,x,I){return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",i,[t[23]||(t[23]=(0,n.Lk)("div",{class:"logo"},[(0,n.Lk)("i",{class:"fas fa-suitcase"}),(0,n.Lk)("h1",null,"行李寄存服務 | Luggage寄存服務")],-1)),x.isSubmitting||x.isPrinting?((0,n.uX)(),(0,n.CE)("div",r,[t[7]||(t[7]=(0,n.Lk)("div",{class:"spinner"},null,-1)),(0,n.Lk)("p",null,(0,s.v_)(x.isSubmitting?"正在提交資料...":"後端正在打印憑證..."),1),(0,n.Lk)("p",null,(0,s.v_)(x.isSubmitting?"Submitting data...":"Backend is printing voucher..."),1)])):(0,n.Q3)("",!0),x.submissionSuccess||x.isSubmitting||x.isPrinting?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("form",{key:1,onSubmit:t[6]||(t[6]=(0,a.D$)((...e)=>I.submitForm&&I.submitForm(...e),["prevent"])),class:"access-form"},[(0,n.Lk)("div",u,[t[8]||(t[8]=(0,n.Lk)("label",{for:"name",class:"required-field"},"姓名 | Name",-1)),(0,n.bo)((0,n.Lk)("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>x.form.name=e),type:"text",placeholder:"請輸入客人姓名 | Please enter your name",required:"",disabled:x.isSubmitting||x.isPrinting},null,8,c),[[a.Jo,x.form.name]])]),(0,n.Lk)("div",d,[t[9]||(t[9]=(0,n.Lk)("label",{for:"phone"},[(0,n.eW)("手機號碼 | Phone Number "),(0,n.Lk)("span",{class:"optional"},"(選填 | Optional)")],-1)),(0,n.bo)((0,n.Lk)("input",{id:"phone","onUpdate:modelValue":t[1]||(t[1]=e=>x.form.phone=e),type:"tel",placeholder:"請輸入手機號碼 | Please enter your phone number",disabled:x.isSubmitting||x.isPrinting},null,8,m),[[a.Jo,x.form.phone]])]),(0,n.Lk)("div",p,[t[10]||(t[10]=(0,n.Lk)("label",{for:"roomNumber"},[(0,n.eW)("房間號碼 | Room Number "),(0,n.Lk)("span",{class:"optional"},"(選填 | Optional)")],-1)),(0,n.bo)((0,n.Lk)("input",{id:"roomNumber","onUpdate:modelValue":t[2]||(t[2]=e=>x.form.roomNumber=e),type:"text",placeholder:"請輸入房間號碼 | Please enter your room number",disabled:x.isSubmitting||x.isPrinting},null,8,g),[[a.Jo,x.form.roomNumber]])]),(0,n.Lk)("div",f,[t[11]||(t[11]=(0,n.Lk)("label",{for:"storageLocation",class:"required-field"},"存放位置 | Storage Location",-1)),(0,n.bo)((0,n.Lk)("input",{id:"storageLocation","onUpdate:modelValue":t[3]||(t[3]=e=>x.form.storageLocation=e),type:"text",placeholder:"請輸入存放位置",required:"",disabled:x.isSubmitting||x.isPrinting},null,8,v),[[a.Jo,x.form.storageLocation]])]),(0,n.Lk)("div",b,[t[12]||(t[12]=(0,n.Lk)("label",{for:"luggageCount",class:"required-field"},"行李件數 | Number of Luggage",-1)),(0,n.bo)((0,n.Lk)("input",{id:"luggageCount","onUpdate:modelValue":t[4]||(t[4]=e=>x.form.luggageCount=e),type:"number",min:"1",max:"40",required:"",disabled:x.isSubmitting||x.isPrinting},null,8,h),[[a.Jo,x.form.luggageCount]])]),(0,n.Lk)("div",y,[t[13]||(t[13]=(0,n.Lk)("label",{for:"remark"},[(0,n.eW)("備註 | Remark "),(0,n.Lk)("span",{class:"optional"},"(選填 | Optional)")],-1)),(0,n.bo)((0,n.Lk)("textarea",{id:"remark","onUpdate:modelValue":t[5]||(t[5]=e=>x.form.remark=e),rows:"1",disabled:x.isSubmitting||x.isPrinting},null,8,k),[[a.Jo,x.form.remark]])]),(0,n.Lk)("button",{type:"submit",class:"btn-submit",disabled:x.isSubmitting||x.isPrinting},t[14]||(t[14]=[(0,n.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,n.eW)(" 提交寄存申請 | Submit Request ")]),8,L)],32)),!x.submissionSuccess||x.isSubmitting||x.isPrinting?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",C,[t[18]||(t[18]=(0,n.Lk)("div",{class:"success-icon"},[(0,n.Lk)("i",{class:"fas fa-check-circle"})],-1)),t[19]||(t[19]=(0,n.Lk)("h2",null,"寄存申請成功！",-1)),t[20]||(t[20]=(0,n.Lk)("h2",null,"Request Submitted Successfully!",-1)),t[21]||(t[21]=(0,n.Lk)("p",null,"已成功儲存資料，後端正在打印憑證",-1)),t[22]||(t[22]=(0,n.Lk)("p",null,"Data saved successfully, backend is printing voucher",-1)),"success"===x.printStatus?((0,n.uX)(),(0,n.CE)("p",R,t[15]||(t[15]=[(0,n.Lk)("i",{class:"fas fa-print"},null,-1),(0,n.eW)(" 憑證打印成功 ")]))):(0,n.Q3)("",!0),"failed"===x.printStatus?((0,n.uX)(),(0,n.CE)("p",w,t[16]||(t[16]=[(0,n.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1),(0,n.eW)(" 打印失敗，請聯繫工作人員 ")]))):(0,n.Q3)("",!0),(0,n.Lk)("div",S,[(0,n.eW)(" 頁面將在 "+(0,s.v_)(x.countdown)+" 秒後重新整理... ",1),t[17]||(t[17]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)(" Page will refresh in "+(0,s.v_)(x.countdown)+" seconds... ",1)])]))])])}o(4114),o(8111),o(116),o(7588);var x=o(144),I=o(153),N=o(1737),T=o(7378);const W=(0,T.b_)({value:{type:[String,Number],default:""},max:{type:Number,default:99},isDot:Boolean,hidden:Boolean,type:{type:String,values:["primary","success","warning","info","danger"],default:"danger"},showZero:{type:Boolean,default:!0},color:String,badgeStyle:{type:(0,T.jq)([String,Object,Array])},offset:{type:(0,T.jq)(Array),default:[0,0]},badgeClass:{type:String}});var _=o(9077),B=o(3513),P=o(2235),j=o(3558);const q=(0,n.pM)({name:"ElBadge"}),$=(0,n.pM)({...q,props:W,setup(e,{expose:t}){const o=e,l=(0,B.DU)("badge"),i=(0,n.EW)(()=>o.isDot?"":(0,P.Et)(o.value)&&(0,P.Et)(o.max)&&o.max<o.value?`${o.max}+`:`${o.value}`),r=(0,n.EW)(()=>{var e,t,n,s,a;return[{backgroundColor:o.color,marginRight:(0,j._V)(-(null!=(t=null==(e=o.offset)?void 0:e[0])?t:0)),marginTop:(0,j._V)(null!=(s=null==(n=o.offset)?void 0:n[1])?s:0)},null!=(a=o.badgeStyle)?a:{}]});return t({content:i}),(e,t)=>((0,n.uX)(),(0,n.CE)("div",{class:(0,s.C4)((0,x.R1)(l).b())},[(0,n.RG)(e.$slots,"default"),(0,n.bF)(a.eB,{name:`${(0,x.R1)(l).namespace.value}-zoom-in-center`,persisted:""},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("sup",{class:(0,s.C4)([(0,x.R1)(l).e("content"),(0,x.R1)(l).em("content",e.type),(0,x.R1)(l).is("fixed",!!e.$slots.default),(0,x.R1)(l).is("dot",e.isDot),(0,x.R1)(l).is("hide-zero",!e.showZero&&0===o.value),e.badgeClass]),style:(0,s.Tr)((0,x.R1)(r))},[(0,n.RG)(e.$slots,"content",{value:(0,x.R1)(i)},()=>[(0,n.eW)((0,s.v_)((0,x.R1)(i)),1)])],6),[[a.aG,!e.hidden&&((0,x.R1)(i)||e.isDot||e.$slots.content)]])]),_:3},8,["name"])],2))}});var M=(0,_.A)($,[["__file","badge.vue"]]),A=o(5376);const X=(0,A.GU)(M);var D=o(813),O=o(464),U=o(6769);const z=["primary","success","info","warning","error"],F=["top","top-left","top-right","bottom","bottom-left","bottom-right"],G="top",Q=(0,U.f)({customClass:"",dangerouslyUseHTMLString:!1,duration:3e3,icon:void 0,id:"",message:"",onClose:void 0,showClose:!1,type:"info",plain:!1,offset:16,placement:void 0,zIndex:0,grouping:!1,repeatNum:1,appendTo:I.oc?document.body:void 0}),V=(0,T.b_)({customClass:{type:String,default:Q.customClass},dangerouslyUseHTMLString:{type:Boolean,default:Q.dangerouslyUseHTMLString},duration:{type:Number,default:Q.duration},icon:{type:O.Ze,default:Q.icon},id:{type:String,default:Q.id},message:{type:(0,T.jq)([String,Object,Function]),default:Q.message},onClose:{type:(0,T.jq)(Function),default:Q.onClose},showClose:{type:Boolean,default:Q.showClose},type:{type:String,values:z,default:Q.type},plain:{type:Boolean,default:Q.plain},offset:{type:Number,default:Q.offset},placement:{type:String,values:F,default:Q.placement},zIndex:{type:Number,default:Q.zIndex},grouping:{type:Boolean,default:Q.grouping},repeatNum:{type:Number,default:Q.repeatNum}}),H={destroy:()=>!0},Y=(0,x.Gc)({}),K=e=>(Y[e]||(Y[e]=(0,x.Gc)([])),Y[e]),J=(e,t)=>{const o=Y[t]||[],n=o.findIndex(t=>t.id===e),s=o[n];let a;return n>0&&(a=o[n-1]),{current:s,prev:a}},Z=(e,t)=>{const{prev:o}=J(e,t);return o?o.vm.exposed.bottom.value:0},ee=(e,t,o)=>{const n=Y[o]||[],s=n.findIndex(t=>t.id===e);return s>0?16:t};var te=o(8114),oe=o(515);const ne=(0,n.pM)({name:"ElMessage"}),se=(0,n.pM)({...ne,props:V,emits:H,setup(e,{expose:t,emit:o}){const l=e,{Close:i}=O.Nk,r=(0,x.KR)(!1),{ns:u,zIndex:c}=(0,te.ht)("message"),{currentZIndex:d,nextZIndex:m}=c,p=(0,x.KR)(),g=(0,x.KR)(!1),f=(0,x.KR)(0);let v;const b=(0,n.EW)(()=>l.type?"error"===l.type?"danger":l.type:"info"),h=(0,n.EW)(()=>{const e=l.type;return{[u.bm("icon",e)]:e&&O.rz[e]}}),y=(0,n.EW)(()=>l.icon||O.rz[l.type]||""),k=(0,n.EW)(()=>l.placement||G),L=(0,n.EW)(()=>Z(l.id,k.value)),C=(0,n.EW)(()=>ee(l.id,l.offset,k.value)+L.value),R=(0,n.EW)(()=>f.value+C.value),w=(0,n.EW)(()=>k.value.includes("left")?u.is("left"):k.value.includes("right")?u.is("right"):u.is("center")),S=(0,n.EW)(()=>k.value.startsWith("top")?"top":"bottom"),E=(0,n.EW)(()=>({[S.value]:`${C.value}px`,zIndex:d.value}));function T(){0!==l.duration&&({stop:v}=(0,I.TO)(()=>{_()},l.duration))}function W(){null==v||v()}function _(){g.value=!1,(0,n.dY)(()=>{var e;r.value||(null==(e=l.onClose)||e.call(l),o("destroy"))})}function B({code:e}){e===oe.R.esc&&_()}return(0,n.sV)(()=>{T(),m(),g.value=!0}),(0,n.wB)(()=>l.repeatNum,()=>{W(),T()}),(0,N.MLh)(document,"keydown",B),(0,N.wYm)(p,()=>{f.value=p.value.getBoundingClientRect().height}),t({visible:g,bottom:R,close:_}),(e,t)=>((0,n.uX)(),(0,n.Wv)(a.eB,{name:(0,x.R1)(u).b("fade"),onBeforeEnter:e=>r.value=!0,onBeforeLeave:e.onClose,onAfterLeave:t=>e.$emit("destroy"),persisted:""},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",{id:e.id,ref_key:"messageRef",ref:p,class:(0,s.C4)([(0,x.R1)(u).b(),{[(0,x.R1)(u).m(e.type)]:e.type},(0,x.R1)(u).is("closable",e.showClose),(0,x.R1)(u).is("plain",e.plain),(0,x.R1)(u).is("bottom","bottom"===(0,x.R1)(S)),(0,x.R1)(w),e.customClass]),style:(0,s.Tr)((0,x.R1)(E)),role:"alert",onMouseenter:W,onMouseleave:T},[e.repeatNum>1?((0,n.uX)(),(0,n.Wv)((0,x.R1)(X),{key:0,value:e.repeatNum,type:(0,x.R1)(b),class:(0,s.C4)((0,x.R1)(u).e("badge"))},null,8,["value","type","class"])):(0,n.Q3)("v-if",!0),(0,x.R1)(y)?((0,n.uX)(),(0,n.Wv)((0,x.R1)(D.tk),{key:1,class:(0,s.C4)([(0,x.R1)(u).e("icon"),(0,x.R1)(h)])},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.Wv)((0,n.$y)((0,x.R1)(y))))]),_:1},8,["class"])):(0,n.Q3)("v-if",!0),(0,n.RG)(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Q3)(" Caution here, message could've been compromised, never use user's input as message "),(0,n.Lk)("p",{class:(0,s.C4)((0,x.R1)(u).e("content")),innerHTML:e.message},null,10,["innerHTML"])],2112)):((0,n.uX)(),(0,n.CE)("p",{key:0,class:(0,s.C4)((0,x.R1)(u).e("content"))},(0,s.v_)(e.message),3))]),e.showClose?((0,n.uX)(),(0,n.Wv)((0,x.R1)(D.tk),{key:2,class:(0,s.C4)((0,x.R1)(u).e("closeBtn")),onClick:(0,a.D$)(_,["stop"])},{default:(0,n.k6)(()=>[(0,n.bF)((0,x.R1)(i))]),_:1},8,["class","onClick"])):(0,n.Q3)("v-if",!0)],46,["id"]),[[a.aG,g.value]])]),_:3},8,["name","onBeforeEnter","onBeforeLeave","onAfterLeave"]))}});var ae=(0,_.A)(se,[["__file","message.vue"]]),le=o(9180),ie=o(3845);const re=(0,T.b_)({a11y:{type:Boolean,default:!0},locale:{type:(0,T.jq)(Object)},size:ie.mU,button:{type:(0,T.jq)(Object)},card:{type:(0,T.jq)(Object)},dialog:{type:(0,T.jq)(Object)},link:{type:(0,T.jq)(Object)},experimentalFeatures:{type:(0,T.jq)(Object)},keyboardNavigation:{type:Boolean,default:!0},message:{type:(0,T.jq)(Object)},zIndex:Number,namespace:{type:String,default:"el"},...le.bs}),ue={placement:"top"};(0,n.pM)({name:"ElConfigProvider",props:re,setup(e,{slots:t}){const o=(0,te.Vh)(e);return(0,n.wB)(()=>e.message,e=>{var t,n;Object.assign(ue,null!=(n=null==(t=null==o?void 0:o.value)?void 0:t.message)?n:{},null!=e?e:{})},{immediate:!0,deep:!0}),()=>(0,n.RG)(t,"default",{config:null==o?void 0:o.value})}});var ce=o(6894);let de=1;const me=e=>{const t=e.appendTo;if(t){if((0,s.Kg)(e.appendTo)){let t=document.querySelector(e.appendTo);(0,P.vq)(t)||(t=document.body),e.appendTo=t}}else e.appendTo=document.body},pe=e=>{!e.placement&&(0,s.Kg)(ue.placement)&&ue.placement&&(e.placement=ue.placement),e.placement||(e.placement=G),F.includes(e.placement)||((0,ce.U)("ElMessage",`Invalid placement: ${e.placement}. Falling back to '${G}'.`),e.placement=G)},ge=e=>{const t=!e||(0,s.Kg)(e)||(0,n.vv)(e)||(0,s.Tn)(e)?{message:e}:e,o={...Q,...t};return me(o),pe(o),(0,P.Lm)(ue.grouping)&&!o.grouping&&(o.grouping=ue.grouping),(0,P.Et)(ue.duration)&&3e3===o.duration&&(o.duration=ue.duration),(0,P.Et)(ue.offset)&&16===o.offset&&(o.offset=ue.offset),(0,P.Lm)(ue.showClose)&&!o.showClose&&(o.showClose=ue.showClose),(0,P.Lm)(ue.plain)&&!o.plain&&(o.plain=ue.plain),o},fe=e=>{const t=e.props.placement||G,o=Y[t],n=o.indexOf(e);if(-1===n)return;o.splice(n,1);const{handler:s}=e;s.close()},ve=({appendTo:e,...t},o)=>{const l="message_"+de++,i=t.onClose,r=document.createElement("div"),u={...t,id:l,onClose:()=>{null==i||i(),fe(p)},onDestroy:()=>{(0,a.XX)(null,r)}},c=(0,n.bF)(ae,u,(0,s.Tn)(u.message)||(0,n.vv)(u.message)?{default:(0,s.Tn)(u.message)?u.message:()=>u.message}:null);c.appContext=o||be._context,(0,a.XX)(c,r),e.appendChild(r.firstElementChild);const d=c.component,m={close:()=>{d.exposed.close()}},p={id:l,vnode:c,vm:d,handler:m,props:c.component.props};return p},be=(e={},t)=>{if(!I.oc)return{close:()=>{}};const o=ge(e),n=K(o.placement||G);if(o.grouping&&n.length){const e=n.find(({vnode:e})=>{var t;return(null==(t=e.props)?void 0:t.message)===o.message});if(e)return e.props.repeatNum+=1,e.props.type=o.type,e.handler}if((0,P.Et)(ue.max)&&n.length>=ue.max)return{close:()=>{}};const s=ve(o,t);return n.push(s),s.handler};function he(e){for(const t in Y)if((0,s.$3)(Y,t)){const o=[...Y[t]];for(const t of o)e&&e!==t.props.type||t.handler.close()}}function ye(e){if(!Y[e])return;const t=[...Y[e]];t.forEach(e=>e.handler.close())}z.forEach(e=>{be[e]=(t={},o)=>{const n=ge(t);return be({...n,type:e},o)}}),be.closeAll=he,be.closeAllByPlacement=ye,be._context=null;const ke=(0,A._u)(be,"$message");var Le=o(8369),Ce=o(1576),Re=o.n(Ce),we=(o(454),o(1928)),Se=o(14);Re().locale("zh-tw");var Ee={name:"GuestAccess",data(){return{form:{name:"",phone:"",roomNumber:"",storageLocation:"",luggageCount:1,remark:""},isSubmitting:!1,isPrinting:!1,submissionSuccess:!1,printStatus:"",countdown:2,countdownInterval:null,savedLuggageRecord:null}},methods:{async submitForm(){try{this.isSubmitting=!0;const e=(0,Se.n)(),t=e.token||localStorage.getItem("token");t?(we.A.setAuthToken(t),console.log("已攜帶權限Token")):console.warn("未取得權限Token，可能導致403錯誤");const o={guestName:this.form.name.trim(),phone:this.form.phone.trim()||null,roomNumber:this.form.roomNumber.trim()||null,storageLocation:this.form.storageLocation.trim(),luggageCount:this.form.luggageCount,remark:this.form.remark.trim()||null,checkinTime:Re()().format("YYYY-MM-DD HH:mm:ss")};console.log("提交行李寄存資料（含備註）:",o);const n=await we.A.create(o);if(!n||!n.data)throw new Error("後端未返回有效資料，請檢查API連線");const s=n.data.id;if(!s)throw new Error("未獲取到有效的行李編號");this.savedLuggageRecord={...n.data,luggageId:s,guestName:this.form.name,phone:this.form.phone,roomNumber:this.form.roomNumber,storageLocation:this.form.storageLocation,luggageCount:this.form.luggageCount,remark:this.form.remark,checkinTime:Re()().format("YYYY-MM-DD HH:mm:ss")},console.log("成功獲取行李記錄（含備註）:",this.savedLuggageRecord),console.log(`調用markAsPrinted接口，ID: ${this.savedLuggageRecord.luggageId}`),await we.A.markAsQrGenerated(this.savedLuggageRecord.luggageId),console.log("QR標籤已成功標記為已列印狀態"),this.isPrinting=!0,this.submissionSuccess=!0,console.log(`請求後端打印，行李ID: ${this.savedLuggageRecord.luggageId}`);const a=await we.A.printVoucher(this.savedLuggageRecord.luggageId);a.data.success?(this.printStatus="success",ke.success("後端打印成功")):(this.printStatus="failed",ke.warning("後端打印失敗，請聯繫工作人員")),this.isPrinting=!1,this.startCountdown()}catch(ce){console.error("提交或打印失敗詳情:",ce);let t="操作失敗，請稍後再試";if(ce.response){const o=ce.response.status,n=ce.response.data;403===o?(t="權限不足（403）：請確認您有提交行李及打印的權限，或重新登入",Le.s.confirm("權限已過期或不足，是否前往登入頁面？","權限錯誤",{confirmButtonText:"前往登入",cancelButtonText:"稍後再試",type:"warning"}).then(()=>{this.$router.push("/login")}).catch(()=>{})):404===o?t="接口不存在（404）：請確認接口路徑是否正確":400===o?t=`參數錯誤（400）：${n.message||"請檢查表單填寫格式"}`:500===o&&(t="伺服器錯誤（500）：請聯繫管理員處理")}ke.error({message:t,duration:6e3}),this.isSubmitting=!1,this.isPrinting=!1}},startCountdown(){this.countdownInterval&&clearInterval(this.countdownInterval),this.countdownInterval=setInterval(()=>{this.countdown--,this.countdown<=0&&(clearInterval(this.countdownInterval),window.location.reload())},1e3)}},beforeUnmount(){this.countdownInterval&&clearInterval(this.countdownInterval)}},xe=o(1241);const Ie=(0,xe.A)(Ee,[["render",E],["__scopeId","data-v-1d00ff8c"]]);var Ne=Ie}}]);
//# sourceMappingURL=705.2e901466.js.map